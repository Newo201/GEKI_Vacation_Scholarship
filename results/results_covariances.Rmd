---
output: 
  github_document
---

```{r}
source('C:/Users/owenj/OneDrive/Uni/Vacation Scholarship/GEKI_Vacation_Scholarship/src/utils/check_covariances.R')
source('C:/Users/owenj/OneDrive/Uni/Vacation Scholarship/GEKI_Vacation_Scholarship/src/models/eki_normal.R')
source('C:/Users/owenj/OneDrive/Uni/Vacation Scholarship/GEKI_Vacation_Scholarship/src/samples/samples_normal.R')
source('C:/Users/owenj/OneDrive/Uni/Vacation Scholarship/GEKI_Vacation_Scholarship/src/utils/eki_helper.R')
```

# Checking Covariances

When testing the EKI algorithm on a multivariate normal model with unknown mean and noise, it was found that the EKI algorithm was not able to identify the true noise parameter, and was anchored to the prior distribution. However, when using summary statistics, we were able to identify the noise parameter. The purpose of this document is to explain this phenomenon.

The main functions for this document can be found in `src/utils/check_covariances.R` I am interested in looking at three variables:

-   How a covariance matrix changes with the prior mean of $\sigma^2$: `plot_covariance_against_sigma2`

-   How a covariance matrix changes with the prior variance of $\sigma^2$: `plot_covariance_against_sigma2_dispersion`

-   How a covariance matrix changes with the prior mean of $\alpha$: `plot_covariance_against_alpha`

# Findings

## Checking $C^{yy}$

Consider what happens to $S = (\bar{y}, s_y)$ as the prior mean for $log(\sigma^2)$. We expect the variance of $\bar{y}$ and $s_y$ to increase. However, when $\alpha$ changes, we expect no change to either of the variances. This is what we find to be the case.

```{r}
plot_covariance_against_sigma2(check_c_yy, "Data Covariance")
plot_covariance_against_alpha(check_c_yy, "Data Covariance")
```

## Checking $C^{yx}$

Unlike when using the full data, we expect a strong correlation between $s_y$ and $\sigma^2$. We also expect a strong correlation between $\bar{y}$ and $\alpha$ (which is not shown in these plots). As such, the EKI algorithm will now be able to determine in what direction to move $\sigma^2$ to become closer to the data.

```{r}
plot_covariance_against_sigma2(check_c_yx, "cross covariance")
```

This is indeed what we see, with the covariance increasing roughly linearly with $\sigma^2$.

## Checking Stepsize

I am also interested in looking at how the particle movement for $\sigma^2$ changes as I vary the parameters of the model. Specifically I am interested in the second column of the matrix

$C^{xy}(C^{yy})^{-1}$ which is equivalent to $C^{xy}(C^{yy} +(h_l^{-1}-1)C^{y|x})^{-1}$ when $h_l = 1$ (i.e. no tempering)

Since the cross covariance matrix no longer contains zeros, we see that the step size for $\sigma^2$ is now positive, albeit decreasing towards zero as $\sigma^2$ increases. However, when $\sigma^2$ is higher, the difference between the samples and the true data will also be more pronounced.

```{r}
plot_covariance_against_sigma2(check_stepsize, "Stepsize")
```

# Implications
